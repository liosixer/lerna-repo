<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%=BASE_URL%><%=VUE_APP_LOGO%>">
  <title><%=VUE_APP_TITLE%></title>
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/element-ui/2.13.2/theme-chalk/index.css" as="style" />
  <% if (process.env.NODE_ENV !== 'development') { %>
    <% for(var css of htmlWebpackPlugin.options.cdn.css) { %>
      <link href="<%=css%>" rel="preload" as="style" />
      <link rel="stylesheet" href="<%=css%>" as="style" />
    <% } %>
    <% for(var js of htmlWebpackPlugin.options.cdn.js) { %>
      <link href="<%=js%>" rel="preload" as="script" />
      <script type="text/javascript" src="<%=js%>"></script>
    <% } %>
  <% } %>
</head>
<body>
  <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
      Please enable it to continue.</strong>
  </noscript>
  <div id="app"></div>
  <!-- built files will be auto injected -->
</body>
<script>
  // 基准大小
  var baseSize = 14
  // 设置 rem 函数
  function setRem() {
    // 当前页面宽度相对于 750 宽的缩放比例，可根据自己需要修改。
    var scale = document.documentElement.clientWidth / 1920
    // 设置页面根节点字体大小
    document.documentElement.style.fontSize = baseSize * Math.min(scale, 2) + 'px'
    // console.log(scale,baseSize * Math.min(scale, 2))
  }
  // 初始化
  setRem()
  // 改变窗口大小时重新设置 rem
  window.onresize = function () {
     setRem();
  }
</script>

<!-- 小龙人 -->
<script>
  (function(a,h,c,b,f,g){a["UdeskApiObject"]=f;a[f]=a[f]||function(){(a[f].d=a[f].d||[]).push(arguments)};g=h.createElement(c);g.async=1;g.charset="utf-8";g.src=b;c=h.getElementsByTagName(c)[0];c.parentNode.insertBefore(g,c)})(window,document,"script","https://assets-cli.s2.udesk.cn/im_client/js/udeskApi.js","ud");
ud({
    "code": "16b07aej",
    "link": "https://bjzhulong.s2.udesk.cn/im_client/?web_plugin_id=29272&group_id=36549"
});
/**
 *  替换原有的客户图标
 *  option{
 *      wrapper: 挂载点，默认是body
 *      interval: 显示间隔 默认30000毫秒
 *      backgroundColor： 提示框背景颜色 默认橘红色
 *      msg 提示信息
        img: 图片背景
        autoShow: 是否关闭整个小龙人，如果不是彻底关闭小龙人，则点击关闭只是关闭消息提示窗
 *      duration:： 显示时长 默认5000毫秒
 * }
 * // 使用 ：new Message()  // 使用默认参数
 *                 new Message(option) 自定义参数
 * 这里是通过自定义一个图标来覆盖第三方客户的图标，为了防止加载的时候出现第三方的图表和自定义的图表一闪而过的情况，建议设置在使用的地方通过css设置第三方图标的背景为不可见
 * #udesk_container {
            display: none;
        }
 */
function Message(option) {
    var option = option || {}
    this.wrapper = option.wrapper || document.body
    this.interval = option.interval || 30000
    this.title = option.title || 'Hi，我是客服小龙人！'
    this.message = option.msg || '有问题请点我咨询哦~'
    this.duration = option.duration || 5000
    this.element = null
    this.state = false
    this.img = option.img || './msg.gif'
    this.color = '#333'
    this.backgroundColor = option.backgroundColor || '#e3e3e3'
    this.disX = 0
    this.disY = 0
    this.x = 0
    this.y = 0
    this.place = option.place || 'right' // 放置在左边还是右边
    this.autoShow = option.autoShow !== undefined ? option.autoShow : true
    this.init()
}
Message.prototype = {
    constructor: Message,
    init: function () {
        this.createNode()
        document.querySelector("#udesk_container").style.display = 'none'
    },
    createNode: function () {
        this.element = document.createElement('div')
        this.setELement(this.element)
        this.wrapper.appendChild(this.element)
        var nodeStr = '<div id="msg-tip" style="height: 60px;padding-top: 15px;border-radius: 5px; width: 160px; padding: 10px; background: ' + this.backgroundColor + '; position: absolute;left: 30px; top:-60px ;color:' + this.color + '"><p style="text-align: right;margin:0; position:absolute; top: -25px;right: -10px;padding-right: 10px;"><span id="msg-close" style="color: #000; display: inline-block; height: 30px; width: 30px;  text-align: center;top: 22px;right: -5px;position: relative; cursor:pointer; z-index: 9999999999">×</span></p><i style="display:block;width: 0;height: 0;border-top: 10px solid transparent;border-right: 10px solid transparent;border-top: 10px solid ' + this.backgroundColor + ';position: absolute; left: 60px; bottom: -10px"></i><h2 style="font-size: 14px; height:27px; white-space:nowrap; overflow:hidden;  line-height:27px; font-weight: bold;margin:0">' + this.title + '</h2><p style="font-size: 12px; margin:0">' + this.message + '</p></div><img style="position:absolute; width: 100%; height: 100%;" src="' + this.img + '"/>'
        this.element.innerHTML = nodeStr
    },
    setELement: function (ele) {
        var me = this
        var cssText = 'position: fixed;'
        var postion = this.place === 'right' ? 'right: 120px;' : 'left: 10px;'
        cssText += 'width: 100px; height: 100px; bottom:50px;' + postion + ' background-size: 100%; z-index: 999'
        ele.setAttribute('style', cssText)
        this.showTip()
        ele.addEventListener('mousedown', this.handleDragStart.bind(this), false)
        ele.addEventListener('mouseover', function (e) {
            var evt = e || window.event
            if (evt.target.tagName.toUpperCase() === 'IMG') {
                ele.style.cursor = 'pointer'
                document.getElementById('msg-tip').style.display = 'block'
            }
        }, false)
        ele.addEventListener('mouseout', function () {
        }, false)
        ele.addEventListener('click', function (e) {
            var evt = e || window.event
            if (evt.target.tagName.toUpperCase() === 'IMG') {
                var disX = Math.abs(me.x - parseInt(me.element.style.left))
                var disY = Math.abs(me.y - parseInt(me.element.style.top))
                console.log(me.element.style.top);
                console.log(me.element.style.left);
                if (me.element.style.top === '' || me.element.style.left === '') {
                    document.getElementById('udesk_btn').children[0].click()
                    return
                }
                if ((disX === 0 && disY === 0)) {
                    document.getElementById('udesk_btn').children[0].click()
                }
                // document.getElementById('udesk_btn').children[0].click()
            }
        }, false)
    },
    showTip: function () {
        var me = this
        if (this.autoShow) {
            setInterval(function () {
                document.getElementById('msg-tip').style.display = 'block'
                setTimeout(function () {
                    if (document.getElementById('msg-tip').style.display === 'block') {
                        document.getElementById('msg-tip').style.display = 'none'
                    }
                }, me.duration)
            }, me.interval)
        }
    },
    handleDragStart: function (e) {
        var evt = e || window.event
        evt.preventDefault()
        evt.stopPropagation()
        if (evt.target.innerHTML === '×') {
            if (!this.autoShow) {
                this.element.style.display = 'none'
            }
            document.getElementById('msg-tip').style.display = 'none'
            return
        }
        document.getElementById('msg-tip').style.display = 'none'
        this.disX = evt.clientX - this.element.offsetLeft
        this.disY = evt.clientY - this.element.offsetTop
        this.x = parseInt(this.element.style.left) || 0
        this.y = parseInt(this.element.style.top) || 0
        this.state = true
        this.element.style.cursor = 'move'
        document.addEventListener('mousemove', this.handleDragMove.bind(this), false)
        document.addEventListener('mouseup', this.handleDragEnd.bind(this), false)
    },
    handleDragMove: function (e) {
        var evt = e || window.event
        evt.preventDefault()
        evt.stopPropagation()
        if (this.state) {
            var left = evt.clientX - this.disX
            var top = evt.clientY - this.disY
            var maxTop = document.documentElement.clientHeight - this.element.offsetHeight
            var maxLeft = document.documentElement.clientWidth - this.element.offsetWidth - 120
            document.getElementById('msg-tip').style.display = 'none'
            if (left <= 0) left = 0
            if (left >= maxLeft) left = maxLeft
            if (top <= 10) top = 0
            if (top >= maxTop) top = maxTop
            this.element.style.left = left + 'px'
            this.element.style.top = top + 'px'
        }
    },

    handleDragEnd: function (e) {
        var evt = e || window.event
        evt.preventDefault()
        evt.stopPropagation()
        this.state = false
        return false
    }
}
window.onload = function () {
    new Message({
        autoShow: false
    })
}
</script>

</html>